<?xml version="1.0" encoding="UTF-8"?>
<sequence name="v1_bulkserviceGET" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
  <script language="js"><![CDATA[mc.setProperty("ERROR_MESSAGE_REQUESTID", "Invalid RequestId " + mc.getProperty("uri.var.RequestId"));]]></script>
  <filter regex="true" source="boolean(get-property('uri.var.RequestId'))">
    <then>
      <log level="custom">
        <property expression="get-property('uri.var.RequestId')" name="defaultBlk-requestid"/>
      </log>
      <switch source="get-property('uri.var.RequestId')">
        <case regex="^\d+$">
          <property name="error_code" scope="default" type="STRING" value="200"/>
        </case>
        <default>
          <!-- perhaps set an error code -->
          <property name="error_code" scope="default" type="STRING" value="400"/>
          <property name="status" scope="default" type="STRING" value="true"/>
          <script language="js"><![CDATA[mc.setProperty("error_description", mc.getProperty("ERROR_MESSAGE_REQUESTID"));]]></script>
        </default>
      </switch>
    </then>
    <else/>
  </filter>
  <switch source="get-property('error_code')">
    <case regex="400">
      <sequence key="gov:com/somos/services/v1/ip/bulkservice/sequences/v1_bulkserviceError.xml"/>
    </case>
    <default/>
  </switch>
</sequence>
